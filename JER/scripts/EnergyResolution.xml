<!--
      Example steering file to run a standard reconstruction on the 3 ttbar events 
      simulated with Mokka in this example dierectory.

      Works with ilcsoft v01-16 (DBD production release)

      Defines the standard reconstruction for ILD.
-->


 <marlin>
   
   <execute>
     <processor name="MyAIDAProcessor"/>
     <processor name="VertexFinder"/>
     <processor name="JetClustering"/>
     <processor name="MyRecoMCTruthLinker"/>
     <processor name="MyEnergyResolution"/>
     <processor name="MyLCIOOutputProcessor"/>
   </execute>

   <global> 
      <parameter name="LCIOInputFiles"> /nfs/dust/ilc/user/voutsina/testarea/ILDConfig/JER.slcio </parameter>
      <parameter name="GearXMLFile" value="GearOutput.xml"/>
      <parameter name="MaxRecordNumber" value="0"/>
      <parameter name="SkipNEvents" value="0"/>
      <parameter name="SupressCheck" value="false"/>
      <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> MESSAGE </parameter>
      <parameter name="RandomSeed" value="1234567890" />
   </global>

 
 <processor name="MyAIDAProcessor" type="AIDAProcessor">
 <!--Processor that handles AIDA files. Creates on directory per processor.  Processors only need to create and fill the histograms, clouds and tuples. Needs to be the first ActiveProcessor-->
  <!-- compression of output file 0: false >0: true (default) -->
  <parameter name="Compress" type="int" value="1"/>
  <!-- filename without extension-->
  <parameter name="FileName" type="string" value="PFOres_test"/>
  <!-- type of output file xml (default) or root ( only OpenScientist)-->
  <parameter name="FileType" type="string" value="root "/>
</processor>


<processor name="MyLCIOOutputProcessor" type="LCIOOutputProcessor">
        <parameter name="LCIOOutputFile" type="string"> jets.slcio </parameter>
        <parameter name="LCIOWriteMode" type="string" value="WRITE_NEW"/>
</processor>


 <processor name="MyRecoMCTruthLinker" type="RecoMCTruthLinker">
 <!--links RecontructedParticles to the MCParticle based on number of hits used-->
   
   <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
   <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> WARNING0  </parameter>
   
   <!--  Input collections: mcparticles, pfos, clusters and tracks
        PFOs already connect to tracks and clusters, so what we do in this processor is to connect
        tracks and clusters to mcparticles ...
        The values given here are the defaults, so they don't really need to be
        specified -->
   <parameter name="MCParticleCollection" type="string" lcioInType="MCParticle"> MCParticle </parameter>
   <!--Name of the ReconstructedParticles input collection-->
   <parameter name="RecoParticleCollection" type="string" lcioInType="ReconstructedParticle"> PandoraPFOs </parameter>
   <!--Name of the Cluster collection -->
   <parameter name="ClusterCollection" type="string" lcioInType="Cluster"> PandoraClusters </parameter>
   <!--Name of the Tracks input collection-->
   <parameter name="TrackCollection" type="string" lcioInType="Track">AidaTTTracks </parameter>
 
   <!-- Don't change any of these hit related collections if you're not very sure you know what you are doing.
       In any case, the ones listed here are the defaults, so they can be removed from
       this steering -->
   <!--  Simulated tracker hits (has the conection to MCParticles -->
   <parameter name="SimTrackerHitCollections" type="StringVec" lcioInType="SimTrackerHit">
     VXDCollection
     SITCollection
     FTD_PIXELCollection
     FTD_STRIPCollection
     TPCCollection
     SETCollection  
   </parameter>
   <!--  Connections from tracker hits (connected to tracks) to sim tracker hits (connects to MC particle) -->
   <parameter name="TrackerHitsRelInputCollections" type="StringVec" lcioInType="LCRelation">
     VXDTrackerHitRelations
     SITSpacePointRelations
     FTDPixelTrackerHitRelations
     FTDSpacePointRelations
     TPCTrackerHitRelations
     SETSpacePointRelations  
   </parameter>
   <!-- same for the calos: Simulated calo hits (has the connection to MCParticles) -->
   <parameter name="SimCaloHitCollections" type="StringVec" lcioInType="SimCalorimeterHit">
     BeamCalCollection
     EcalBarrelSiliconCollection
     EcalBarrelSiliconPreShowerCollection
     EcalEndcapRingCollection
     EcalEndcapRingPreShowerCollection
     EcalEndcapSiliconCollection
     EcalEndcapSiliconPreShowerCollection
     HcalBarrelRegCollection
     HcalEndCapRingsCollection
     HcalEndCapsCollection
     LHcalCollection
     LumiCalCollection
     MuonBarrelCollection
     MuonEndCapCollection
   </parameter>
   <!-- Connections from calo hist (connected to clusters) tp sim calo hits  (connects to MC particle) -->
   <parameter name="SimCalorimeterHitRelationNames" type="StringVec" lcioInType="LCRelation">
     RelationCaloHit
     RelationLHcalHit
     RelationMuonHit
     RelationLcalHit
     RelationBCalHit
   </parameter>
   
   <!--PDG codes of particles of which the daughters will be kept in the skimmmed MCParticle collection-->
   <parameter name="KeepDaughtersPDG" type="IntVec"> 22 111 310 13 211 321</parameter>
   
   <!--Names of the output collections -->
   <!--Name of the skimmed MCParticle  output collection-->
   <parameter name="MCParticlesSkimmedName" type="string" lcioOutType="MCParticle"> MCParticlesSkimmed </parameter>
   
   <!-- links between tracks or clusters and mcparticles. The two sets differ
       in what the weight means. These four will only be output if the
       name is given here in the steering -->
   <parameter name="MCTruthTrackLinkName" type="string" lcioOutType="LCRelation"> MCTruthAidaTTTracksLink </parameter>  
   <parameter name="TrackMCTruthLinkName" type="string" lcioOutType="LCRelation"> AidaTTTracksMCTruthLink </parameter>
   <parameter name="MCTruthClusterLinkName" type="string" lcioOutType="LCRelation"> MCTruthClusterLink </parameter>
   <parameter name="ClusterMCTruthLinkName" type="string" lcioOutType="LCRelation"> ClusterMCTruthLink </parameter>


   <!-- Links PFO <-> MCParticles. Only RecoMCTruthLink is output by default,
       to also get the reverse link, MCTruthRecoLinkName must be given here -->
   <parameter name="RecoMCTruthLinkName" type="string" lcioOutType="LCRelation"> RecoMCTruthLink </parameter>
   <parameter name="MCTruthRecoLinkName" type="string" lcioOutType="LCRelation"> MCTruthRecoLink </parameter>
   <!-- set to true to get the weights in RecoMCTruthLink to include both weights to
       tracks and clusters. False implies that only the true particle that
       gives most contributions to the track of the PFO (charged PFOs), or
       to the cluster (neutral ones) is linked to the PFO -->
   <parameter name="FullRecoRelation" type="bool"> true </parameter>
   
   <!-- further options -->
   <!--true: use relations for TrackerHits, false : use getRawHits -->
   <parameter name="UseTrackerHitRelations" type="bool"> true </parameter>
   <!--If Using Particle Gun Ignore Gen Stat-->
   <parameter name="UsingParticleGun" type="bool"> true </parameter>
 </processor>



 <processor name="MyDiagnostics" type="Diagnostics">
  <!--Name of the studied track collection-->
  <parameter name="StudiedTracks" type="string" lcioInType="Track"> MarlinTrkTracks </parameter>
  <!--true - reco relation collection-->
  <parameter name="MCTracksTruthLinkCollectionName" type="string" lcioInType="Track"> MCTruthMarlinTrkTracksLink </parameter>
  <!--reco - true relation collection-->
  <parameter name="TracksMCTruthLinkCollectionName" type="string" lcioInType="Track"> MarlinTrkTracksMCTruthLink </parameter>
  <!--Name of the MCParticle input collection-->
  <parameter name="MCParticleCollection" type="string" lcioInType="MCParticle"> MCParticle </parameter>
  <!--Enables cuts to define the examined track sample-->
  <parameter name="TrkEffOn" type="bool"> true </parameter>
  <!--To study the Silicon tracking efficiency-->
  <parameter name="SiTrkEffOn" type="bool"> false </parameter>
  <!--Should be true when we study a simulated physics sample-->
  <parameter name="PhysSampleOn" type="bool"> true </parameter>
  <!--Maximum costheta of examined MCParticles sample-->
  <parameter name="CosThetaCut" type="double"> 0.9 </parameter>
  <!--Minimum momentum of examined MCParticles sample (in GeV)-->
  <parameter name="PCut" type="double"> 0.3 </parameter>
  <!--Minimum transverse momentum of examined MCParticles sample (in GeV)-->
  <parameter name="PTCut" type="double"> 0.3 </parameter>
  <!--Maximum distance from IP of examined MCParticles sample (in mm)-->
  <parameter name="DistFromIP" type="double"> 10.0 </parameter>
  <!--ratio of hits belonging to the dominant MC particle to total number of track hits-->
  <parameter name="RequiredPurity" type="double"> 0.74 </parameter>
  <!--minimum required hits on Si detectors in order to consider the track found-->
  <parameter name="RequiredSiHits" type="int"> 4 </parameter>
  <!--Requirement that the innermost VXD hit should be found-->
  <parameter name="ReqInnVXDHit" type="bool"> false </parameter>
  <parameter name="SimTrackerHitCollections" type="StringVec" lcioInType="SimTrackerHit"> VXDCollection SITCollection TPCCollection </parameter>
  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <parameter name="Verbosity" type="string"> MESSAGE </parameter>
</processor>

 <processor name="MyEnergyResolution" type="EnergyResolution">
</processor>


<processor name="JetClustering" type="LcfiplusProcessor">
       
        <!-- run primary and secondary vertex finders -->
        <parameter name="Algorithms" type="stringVec"> JetClustering JetVertexRefiner</parameter>
       
        <!-- general parameters -->
        <parameter name="PFOCollection" type="string" value="PandoraPFOs" /> <!-- input PFO collection -->
        <parameter name="UseMCP" type="int" value="0" /> <!-- MC info not used -->
        <parameter name="MCPCollection" type="string" value="" /> <!-- not used -->
        <parameter name="MCPFORelation" type="string" value="" /> <!-- not used -->
        <parameter name="ReadSubdetectorEnergies" type="int" value="1"/> <!-- true for ILD -->
        <parameter name="UpdateVertexRPDaughters" type="int" value="0"/> <!-- false for non-updative PandoraPFOs -->
        <parameter name="TrackHitOrdering" type="int" value="1"/> <!-- Track hit ordering: 0=ILD-LOI,SID-DBD, 1=ILD-DBD -->
        <parameter name="PrintEventNumber" type="int" value="0"/> <!-- 0 for not printing event number, n for printing every n events -->
       
        <!-- jet clustering parameters -->
        <parameter name="JetClustering.InputVertexCollectionName" type="string" value="BuildUpVertex" /> <!-- vertex collections to be used in JC -->
        <parameter name="JetClustering.OutputJetCollectionName" type="stringVec" value="VertexJets" /> <!-- output collection name, may be multiple -->
        <parameter name="JetClustering.NJetsRequested" type="intVec" value="2" /> <!-- Multiple NJets can be specified -->
       
        <parameter name="JetClustering.YCut" type="doubleVec" value="0." /> <!-- specify 0 if not used -->
        <parameter name="JetClustering.UseMuonID" type="int" value="1" /> <!-- jet-muon ID for jet clustering -->
        <parameter name="JetClustering.VertexSelectionMinimumDistance" type="double" value="0.3" /> <!-- in mm -->
        <parameter name="JetClustering.VertexSelectionMaximumDistance" type="double" value="30." /> <!-- in mm -->
        <parameter name="JetClustering.VertexSelectionK0MassWidth" type="double" value="0.02" /> <!-- in GeV -->
        <parameter name="JetClustering.YAddedForJetVertexVertex" type="double" value="100"/> <!-- add penalty for combining vertices -->
        <parameter name="JetClustering.YAddedForJetLeptonVertex" type="double" value="100"/> <!-- add penalty for combining lepton and vertex -->
        <parameter name="JetClustering.YAddedForJetLeptonLepton" type="double" value="100"/> <!-- add penalty for combining leptons -->
       
        <!-- vertex refiner parameters -->
        <parameter name="JetVertexRefiner.InputJetCollectionName" type="string" value="VertexJets" />
        <parameter name="JetVertexRefiner.OutputJetCollectionName" type="string" value="RefinedJets" />
        <parameter name="JetVertexRefiner.PrimaryVertexCollectionName" type="string" value="PrimaryVertex" />
        <parameter name="JetVertexRefiner.InputVertexCollectionName" type="string" value="BuildUpVertex" />
        <parameter name="JetVertexRefiner.V0VertexCollectionName" type="string" value="BuildUpVertex_V0" />
        <parameter name="JetVertexRefiner.OutputVertexCollectionName" type="string" value="RefinedVertex" />
       
        <parameter name="JetVertexRefiner.MinPosSingle" type="double" value="0.3" />
        <parameter name="JetVertexRefiner.MaxPosSingle" type="double" value="30." />
        <parameter name="JetVertexRefiner.MinEnergySingle" type="double" value="1." />
        <parameter name="JetVertexRefiner.MaxAngleSingle" type="double" value="0.5" />
        <parameter name="JetVertexRefiner.MaxSeparationPerPosSingle" type="double" value="0.1" />
        <parameter name="JetVertexRefiner.mind0sigSingle" type="double" value="5." />
        <parameter name="JetVertexRefiner.minz0sigSingle" type="double" value="5." />
        <parameter name="JetVertexRefiner.OneVertexProbThreshold" type="double" value="0.001" />
        <parameter name="JetVertexRefiner.MaxCharmFlightLengthPerJetEnergy" type="double" value="0.1" />
</processor>


<processor name="VertexFinder" type="LcfiplusProcessor">
       
        <!-- run primary and secondary vertex finders -->
        <parameter name="Algorithms" type="stringVec"> PrimaryVertexFinder BuildUpVertex </parameter>
        <parameter name="ReadSubdetectorEnergies" type="int" value="1"/> <!-- true for ILD -->
        <parameter name="UpdateVertexRPDaughters" type="int" value="0"/> <!-- false for non-updative PandoraPFOs -->
        <parameter name="TrackHitOrdering" type="int" value="1"/> <!-- Track hit ordering: 0=ILD-LOI,SID-DBD, 1=ILD-DBD -->
        <parameter name="PrintEventNumber" type="int" value="0"/> <!-- 0 for not printing event number, n for printing every n events -->
       
        <!-- specify input collection names -->
        <parameter name="PFOCollection" type="string" value="PandoraPFOs" />
        <parameter name="PrimaryVertexCollectionName" type="string" value="PrimaryVertex" />
        <parameter name="BuildUpVertexCollectionName" type="string" value="BuildUpVertex" />
        <parameter name="BuildUpVertex.V0VertexCollectionName" type="string" value="BuildUpVertex_V0" />
       
        <!-- parameters for primary vertex finder -->
        <parameter name="PrimaryVertexFinder.TrackMaxD0" type="double" value="20." />
        <parameter name="PrimaryVertexFinder.TrackMaxZ0" type="double" value="20." />
        <parameter name="PrimaryVertexFinder.TrackMaxInnermostHitRadius" type="double" value="20." />
        <parameter name="PrimaryVertexFinder.TrackMinVtxFtdHits" type="int" value="1" />
        <parameter name="PrimaryVertexFinder.Chi2Threshold" type="double" value="25." />
       
        <!-- parameters for secondary vertex finder -->
        <parameter name="BuildUpVertex.TrackMaxD0" type="double" value="10." />
        <parameter name="BuildUpVertex.TrackMaxZ0" type="double" value="20." />
        <parameter name="BuildUpVertex.TrackMinPt" type="double" value="0.1" />
        <parameter name="BuildUpVertex.TrackMaxD0Err" type="double" value="0.1" />
        <parameter name="BuildUpVertex.TrackMaxZ0Err" type="double" value="0.1" />
        <parameter name="BuildUpVertex.TrackMinTpcHits" type="int" value="20" />
        <parameter name="BuildUpVertex.TrackMinFtdHits" type="int" value="3" />
        <parameter name="BuildUpVertex.TrackMinVxdHits" type="int" value="3" />
        <parameter name="BuildUpVertex.TrackMinVxdFtdHits" type="int" value="1" />
        <parameter name="BuildUpVertex.PrimaryChi2Threshold" type="double" value="25." />
        <parameter name="BuildUpVertex.SecondaryChi2Threshold" type="double" value="9." />
        <parameter name="BuildUpVertex.MassThreshold" type="double" value="10." />
        <parameter name="BuildUpVertex.MinDistFromIP" type="double" value="0.3" />
        <parameter name="BuildUpVertex.MaxChi2ForDistOrder" type="double" value="1.0" />
        <parameter name="BuildUpVertex.AssocIPTracks" type="int" value="1" />
        <parameter name="BuildUpVertex.AssocIPTracksMinDist" type="double" value="0." />
        <parameter name="BuildUpVertex.AssocIPTracksChi2RatioSecToPri" type="double" value="2.0" />
        <parameter name="BuildUpVertex.UseV0Selection" type="int" value="1" />
       
</processor>
  
</marlin>
